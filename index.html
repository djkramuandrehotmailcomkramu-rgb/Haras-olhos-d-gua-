
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema Profissional de Controle de Haras - Vers√£o Cloud">
    <meta name="theme-color" content="#059669">
    <title>JCA Haras Control PRO üê¥</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23059669' width='100' height='100' rx='20'/><text x='50' y='70' font-size='60' text-anchor='middle' fill='white' font-weight='bold' font-family='Arial'>JCA</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .animate-pulse-slow { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .horse-card { transition: all 0.3s ease; }
        .horse-card:hover { transform: translateY(-4px); }
        .logo-jca {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 900;
            letter-spacing: 2px;
            box-shadow: 0 4px 6px rgba(5, 150, 105, 0.3);
        }
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
            border-radius: 12px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 min-h-screen">
    <div id="app"></div>

    <script>
        // Configura√ß√£o do Supabase
        const SUPABASE_URL = 'https://wfnpmdwlpccrppkbvdta.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndmbnBtZHdscGNjcnBwa2J2ZHRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNzc0MjMsImV4cCI6MjA4MDg1MzQyM30.232e1z9ssCk64xyOmU80cwFqF2bny9h_8cYoqA4fwY8';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let state = {
            user: null,
            horses: [],
            selectedHorse: null,
            showForm: false,
            loading: true,
            saving: false,
            activeView: 'horses', // 'horses' ou 'expenses'
            expenseFilter: {
                horseId: 'all',
                month: new Date().toISOString().slice(0, 7)
            }
        };

        let formData = {
            name: '', breed: '', age: '', gender: 'Macho',
            color: '', registration: '', photo: '', notes: ''
        };

        // Verificar sess√£o ao carregar
        async function init() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                state.user = session.user;
                await loadHorses();
            }
            state.loading = false;
            render();
        }

        // Login
        window.handleLogin = async function() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('‚ö†Ô∏è Preencha email e senha!');
                return;
            }

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                state.user = data.user;
                await loadHorses();
                render();
            } catch (error) {
                alert('‚ùå Erro no login: ' + error.message);
            }
        };

        // Registro
        window.handleSignup = async function() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirm').value;

            if (!email || !password || !confirmPassword) {
                alert('‚ö†Ô∏è Preencha todos os campos!');
                return;
            }

            if (password !== confirmPassword) {
                alert('‚ö†Ô∏è As senhas n√£o coincidem!');
                return;
            }

            if (password.length < 6) {
                alert('‚ö†Ô∏è A senha deve ter pelo menos 6 caracteres!');
                return;
            }

            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });

                if (error) throw error;

                alert('‚úÖ Conta criada com sucesso! Fa√ßa login para continuar.');
                document.getElementById('signupEmail').value = '';
                document.getElementById('signupPassword').value = '';
                document.getElementById('signupConfirm').value = '';
            } catch (error) {
                alert('‚ùå Erro ao criar conta: ' + error.message);
            }
        };

        // Logout
        window.handleLogout = async function() {
            if (confirm('Deseja sair?')) {
                await supabase.auth.signOut();
                state.user = null;
                state.horses = [];
                state.selectedHorse = null;
                render();
            }
        };

        // Carregar cavalos
        async function loadHorses() {
            try {
                const { data, error } = await supabase
                    .from('horses')
                    .select(`
                        *,
                        vaccines(*),
                        medications(*),
                        expenses(*),
                        shoeing(*),
                        dewormings(*)
                    `)
                    .order('created_at', { ascending: false });

                if (error) throw error;
                state.horses = data || [];
            } catch (error) {
                console.error('Erro ao carregar cavalos:', error);
                alert('Erro ao carregar dados');
            }
        }

        // Adicionar cavalo
        window.addHorse = async function() {
            if (!formData.name || !formData.breed) {
                alert('‚ö†Ô∏è Preencha ao menos o Nome e a Ra√ßa!');
                return;
            }

            state.saving = true;
            render();

            try {
                const { data, error } = await supabase
                    .from('horses')
                    .insert([{
                        name: formData.name,
                        breed: formData.breed,
                        age: parseInt(formData.age) || 0,
                        gender: formData.gender,
                        color: formData.color,
                        registration: formData.registration,
                        photo: formData.photo,
                        notes: formData.notes,
                        user_id: state.user.id
                    }])
                    .select();

                if (error) throw error;

                formData = { name: '', breed: '', age: '', gender: 'Macho', color: '', registration: '', photo: '', notes: '' };
                state.showForm = false;
                await loadHorses();
                alert('‚úÖ Cavalo adicionado com sucesso!');
            } catch (error) {
                alert('‚ùå Erro ao adicionar cavalo: ' + error.message);
            }

            state.saving = false;
            render();
        };

        // Editar cavalo
        window.editHorse = function(horse) {
            formData = {
                id: horse.id,
                name: horse.name,
                breed: horse.breed,
                age: horse.age,
                gender: horse.gender,
                color: horse.color,
                registration: horse.registration,
                photo: horse.photo,
                notes: horse.notes
            };
            state.showForm = true;
            state.selectedHorse = null;
            render();
        };

        // Atualizar cavalo
        window.updateHorse = async function() {
            if (!formData.name || !formData.breed) {
                alert('‚ö†Ô∏è Preencha ao menos o Nome e a Ra√ßa!');
                return;
            }

            state.saving = true;
            render();

            try {
                const { error } = await supabase
                    .from('horses')
                    .update({
                        name: formData.name,
                        breed: formData.breed,
                        age: parseInt(formData.age) || 0,
                        gender: formData.gender,
                        color: formData.color,
                        registration: formData.registration,
                        photo: formData.photo,
                        notes: formData.notes
                    })
                    .eq('id', formData.id);

                if (error) throw error;

                formData = { name: '', breed: '', age: '', gender: 'Macho', color: '', registration: '', photo: '', notes: '' };
                state.showForm = false;
                await loadHorses();
                alert('‚úÖ Cavalo atualizado com sucesso!');
            } catch (error) {
                alert('‚ùå Erro ao atualizar: ' + error.message);
            }

            state.saving = false;
            render();
        };

        // Deletar cavalo
        window.deleteHorse = async function(id) {
            if (!confirm('Tem certeza que deseja excluir este cavalo?')) return;

            try {
                const { error } = await supabase
                    .from('horses')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                await loadHorses();
                if (state.selectedHorse?.id === id) state.selectedHorse = null;
                alert('‚úÖ Cavalo exclu√≠do!');
                render();
            } catch (error) {
                alert('‚ùå Erro ao excluir: ' + error.message);
            }
        };

        // Adicionar vacina
        window.addVaccine = async function() {
            const date = document.getElementById('vaccineDate').value;
            const vaccine = document.getElementById('vaccineName').value;
            const nextDate = document.getElementById('vaccineNext').value;

            if (!date || !vaccine) {
                alert('‚ö†Ô∏è Preencha ao menos a data e o nome da vacina!');
                return;
            }

            try {
                const { error } = await supabase
                    .from('vaccines')
                    .insert([{
                        horse_id: state.selectedHorse.id,
                        date: date,
                        vaccine: vaccine,
                        next_date: nextDate || null
                    }]);

                if (error) throw error;

                document.getElementById('vaccineDate').value = '';
                document.getElementById('vaccineName').value = '';
                document.getElementById('vaccineNext').value = '';
                
                await loadHorses();
                state.selectedHorse = state.horses.find(h => h.id === state.selectedHorse.id);
                render();
            } catch (error) {
                alert('‚ùå Erro: ' + error.message);
            }
        };

        // Adicionar medica√ß√£o
        window.addMedication = async function() {
            const date = document.getElementById('medDate').value;
            const medication = document.getElementById('medName').value;
            const dosage = document.getElementById('medDosage').value;
            const vet = document.getElementById('medVet').value;

            if (!date || !medication) {
                alert('‚ö†Ô∏è Preencha ao menos a data e a medica√ß√£o!');
                return;
            }

            try {
                const { error } = await supabase
                    .from('medications')
                    .insert([{
                        horse_id: state.selectedHorse.id,
                        date: date,
                        medication: medication,
                        dosage: dosage,
                        vet: vet
                    }]);

                if (error) throw error;

                document.getElementById('medDate').value = '';
                document.getElementById('medName').value = '';
                document.getElementById('medDosage').value = '';
                document.getElementById('medVet').value = '';
                
                await loadHorses();
                state.selectedHorse = state.horses.find(h => h.id === state.selectedHorse.id);
                render();
            } catch (error) {
                alert('‚ùå Erro: ' + error.message);
            }
        };

        // Adicionar gasto
        window.addExpense = async function() {
            const date = document.getElementById('expDate').value;
            const description = document.getElementById('expDesc').value;
            const amount = document.getElementById('expAmount').value;
            const category = document.getElementById('expCategory').value;

            if (!date || !description || !amount) {
                alert('‚ö†Ô∏è Preencha todos os campos!');
                return;
            }

            try {
                const { error } = await supabase
                    .from('expenses')
                    .insert([{
                        horse_id: state.selectedHorse.id,
                        date: date,
                        description: description,
                        amount: parseFloat(amount),
                        category: category
                    }]);

                if (error) throw error;

                document.getElementById('expDate').value = '';
                document.getElementById('expDesc').value = '';
                document.getElementById('expAmount').value = '';
                
                await loadHorses();
                state.selectedHorse = state.horses.find(h => h.id === state.selectedHorse.id);
                render();
            } catch (error) {
                alert('‚ùå Erro: ' + error.message);
            }
        };

        // Adicionar ferrageamento
        window.addShoeing = async function() {
            const date = document.getElementById('shoeDate').value;
            const nextDate = document.getElementById('shoeNext').value;
            const farrier = document.getElementById('shoeFarrier').value;
            const notes = document.getElementById('shoeNotes').value;

            if (!date) {
                alert('‚ö†Ô∏è Preencha a data!');
                return;
            }

            try {
                const { error } = await supabase
                    .from('shoeing')
                    .insert([{
                        horse_id: state.selectedHorse.id,
                        date: date,
                        next_date: nextDate || null,
                        farrier: farrier,
                        notes: notes
                    }]);

                if (error) throw error;

                document.getElementById('shoeDate').value = '';
                document.getElementById('shoeNext').value = '';
                document.getElementById('shoeFarrier').value = '';
                document.getElementById('shoeNotes').value = '';
                
                await loadHorses();
                state.selectedHorse = state.horses.find(h => h.id === state.selectedHorse.id);
                render();
            } catch (error) {
                alert('‚ùå Erro: ' + error.message);
            }
        };

        // Deletar item
        window.deleteItem = async function(table, id) {
            if (!confirm('Deseja excluir?')) return;

            try {
                const { error } = await supabase
                    .from(table)
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                await loadHorses();
                state.selectedHorse = state.horses.find(h => h.id === state.selectedHorse.id);
                render();
            } catch (error) {
                alert('‚ùå Erro: ' + error.message);
            }
        };

        window.handleImageUpload = function(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5000000) {
                    alert('‚ö†Ô∏è Imagem muito grande! M√°ximo 5MB.');
                    return;
                }
                
                // Comprimir imagem se for maior que 1MB
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        // Redimensionar se for muito grande
                        const maxSize = 1200;
                        if (width > maxSize || height > maxSize) {
                            if (width > height) {
                                height = (height / width) * maxSize;
                                width = maxSize;
                            } else {
                                width = (width / height) * maxSize;
                                height = maxSize;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Comprimir para JPEG com qualidade 0.8
                        formData.photo = canvas.toDataURL('image/jpeg', 0.8);
                        render();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        };

        window.selectHorse = function(id) {
            state.selectedHorse = state.horses.find(h => h.id === id);
            render();
        };

        window.backToList = function() {
            state.selectedHorse = null;
            render();
        };

        window.toggleForm = function() {
            state.showForm = !state.showForm;
            render();
        };

        window.removePhoto = function() {
            formData.photo = '';
            render();
        };

        window.updateFormData = function(field, value) {
            formData[field] = value;
        };

        function getTotalExpenses(horse) {
            return horse.expenses?.reduce((sum, exp) => sum + parseFloat(exp.amount), 0) || 0;
        }

        function render() {
            const app = document.getElementById('app');

            if (state.loading) {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="text-center">
                            <div class="logo-jca text-white text-4xl mb-4 inline-block">JCA</div>
                            <p class="text-xl text-gray-600">Carregando...</p>
                        </div>
                    </div>
                `;
                return;
            }

            if (!state.user) {
                app.innerHTML = renderLogin();
                return;
            }

            if (state.selectedHorse) {
                app.innerHTML = renderHorseDetail();
            } else if (state.activeView === 'expenses') {
                app.innerHTML = renderExpensesView();
            } else {
                app.innerHTML = renderHorseList();
            }
        }

        function renderLogin() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                        <div class="text-center mb-8">
                            <div class="logo-jca text-white text-3xl inline-block mb-4">JCA</div>
                            <h1 class="text-3xl font-black text-gray-800">Haras Control PRO</h1>
                            <p class="text-gray-500 mt-2">‚òÅÔ∏è Vers√£o Cloud</p>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800 mb-4">Login</h2>
                                <input type="email" id="loginEmail" placeholder="Email" 
                                    class="w-full p-3 border-2 rounded-xl mb-3 focus:ring-2 focus:ring-emerald-500">
                                <input type="password" id="loginPassword" placeholder="Senha" 
                                    class="w-full p-3 border-2 rounded-xl mb-3 focus:ring-2 focus:ring-emerald-500">
                                <button onclick="handleLogin()" 
                                    class="w-full py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-700 transition">
                                    Entrar
                                </button>
                            </div>

                            <div class="border-t pt-6">
                                <h2 class="text-xl font-bold text-gray-800 mb-4">Criar Conta</h2>
                                <input type="email" id="signupEmail" placeholder="Email" 
                                    class="w-full p-3 border-2 rounded-xl mb-3 focus:ring-2 focus:ring-blue-500">
                                <input type="password" id="signupPassword" placeholder="Senha (m√≠nimo 6 caracteres)" 
                                    class="w-full p-3 border-2 rounded-xl mb-3 focus:ring-2 focus:ring-blue-500">
                                <input type="password" id="signupConfirm" placeholder="Confirmar senha" 
                                    class="w-full p-3 border-2 rounded-xl mb-3 focus:ring-2 focus:ring-blue-500">
                                <button onclick="handleSignup()" 
                                    class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition">
                                    Criar Conta
                                </button>
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-emerald-50 rounded-xl border border-emerald-200">
                            <p class="text-sm text-emerald-800">
                                <strong>‚ú® Novidade:</strong> Agora com dados sincronizados na nuvem! Todos da equipe veem as mesmas informa√ß√µes em tempo real.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHorseList() {
            const horsesHTML = state.horses.map(horse => `
                <div class="bg-white horse-card p-5 rounded-2xl border shadow-lg fade-in">
                    ${horse.photo ? `<img src="${horse.photo}" class="w-full h-48 object-cover rounded-xl mb-4">` : ''}
                    <div class="flex justify-between mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">${horse.name}</h3>
                            <p class="text-emerald-600 font-semibold">${horse.breed}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editHorse(${JSON.stringify(horse).replace(/"/g, '&quot;')})" class="p-2.5 bg-amber-600 text-white rounded-xl hover:bg-amber-700">üìù</button>
                            <button onclick="selectHorse(${horse.id})" class="p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700">üëÅÔ∏è</button>
                            <button onclick="deleteHorse(${horse.id})" class="p-2.5 bg-red-600 text-white rounded-xl hover:bg-red-700">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3 text-sm mb-4">
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <p class="text-xs text-gray-500">Idade</p>
                            <p class="font-semibold">${horse.age} anos</p>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <p class="text-xs text-gray-500">Sexo</p>
                            <p class="font-semibold">${horse.gender}</p>
                        </div>
                    </div>
                    <div class="bg-emerald-50 p-3 rounded-lg border border-emerald-200">
                        <p class="text-emerald-800 font-bold text-lg">üí∞ R$ ${getTotalExpenses(horse).toFixed(2)}</p>
                        <p class="text-xs text-emerald-600">Total em gastos</p>
                    </div>
                </div>
            `).join('');

            return `
                <div class="max-w-7xl mx-auto p-4 md:p-6">
                    <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-8 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center gap-4">
                                <div class="logo-jca text-white text-2xl">JCA</div>
                                <div>
                                    <h1 class="text-3xl font-black text-gray-800">Haras Control PRO</h1>
                                    <p class="text-gray-500 text-sm">‚òÅÔ∏è {state.user.email}</p>
                                </div>
                            </div>
                            <button onclick="handleLogout()" class="px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600">
                                Sair
                            </button>
                        </div>

                        <div class="flex gap-3 flex-wrap">
                            <button onclick="setActiveView('horses')" 
                                class="px-6 py-3 ${state.activeView === 'horses' ? 'bg-emerald-600' : 'bg-gray-400'} text-white rounded-xl font-semibold shadow-lg">
                                üê¥ Cavalos
                            </button>
                            <button onclick="setActiveView('expenses')" 
                                class="px-6 py-3 ${state.activeView === 'expenses' ? 'bg-emerald-600' : 'bg-gray-400'} text-white rounded-xl font-semibold shadow-lg">
                                üí∞ Gastos
                            </button>
                            ${state.activeView === 'horses' ? `
                                <button onclick="toggleForm()" class="px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold shadow-lg">
                                    ‚ûï Novo Cavalo
                                </button>
                            ` : ''}
                        </div>

                        ${state.showForm ? `
                            <div class="bg-blue-50 p-6 rounded-2xl mt-6 border-2 border-blue-200 fade-in">
                                <h3 class="text-2xl font-bold text-blue-900 mb-6">‚ú® ${formData.id ? 'Editar' : 'Novo'} Cavalo</h3>
                                
                                ${formData.photo ? `
                                    <div class="mb-4 text-center">
                                        <img src="${formData.photo}" class="image-preview mx-auto shadow-lg">
                                        <div class="flex gap-2 justify-center mt-2">
                                            <label class="cursor-pointer px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                                                üì∑ Trocar Foto
                                                <input type="file" accept="image/*" onchange="handleImageUpload(event)" class="hidden">
                                            </label>
                                            <button onclick="removePhoto()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm">
                                                üóëÔ∏è Remover
                                            </button>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="mb-6">
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">üì∑ Foto do Cavalo</label>
                                        <input type="file" accept="image/*" onchange="handleImageUpload(event)"
                                            class="w-full p-3 border-2 border-dashed border-blue-300 rounded-xl bg-white hover:border-blue-500 cursor-pointer">
                                        <p class="text-xs text-gray-500 mt-1">M√°ximo 5MB - A imagem ser√° otimizada automaticamente</p>
                                    </div>
                                `}

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                    <input type="text" placeholder="Nome *" value="${formData.name}" oninput="updateFormData('name', this.value)" 
                                        class="p-3 border-2 rounded-xl">
                                    <input type="text" placeholder="Ra√ßa *" value="${formData.breed}" oninput="updateFormData('breed', this.value)" 
                                        class="p-3 border-2 rounded-xl">
                                    <input type="number" placeholder="Idade" value="${formData.age}" oninput="updateFormData('age', this.value)" 
                                        class="p-3 border-2 rounded-xl">
                                    <select onchange="updateFormData('gender', this.value)" class="p-3 border-2 rounded-xl">
                                        <option ${formData.gender === 'Macho' ? 'selected' : ''}>Macho</option>
                                        <option ${formData.gender === 'F√™mea' ? 'selected' : ''}>F√™mea</option>
                                    </select>
                                    <input type="text" placeholder="Pelagem" value="${formData.color}" oninput="updateFormData('color', this.value)" 
                                        class="p-3 border-2 rounded-xl">
                                    <input type="text" placeholder="Registro" value="${formData.registration}" oninput="updateFormData('registration', this.value)" 
                                        class="p-3 border-2 rounded-xl">
                                </div>
                                <textarea placeholder="Observa√ß√µes" rows="3" oninput="updateFormData('notes', this.value)"
                                    class="w-full p-3 border-2 rounded-xl">${formData.notes}</textarea>
                                <div class="flex gap-3 mt-6">
                                    <button onclick="${formData.id ? 'updateHorse()' : 'addHorse()'}" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700">
                                        ${state.saving ? '‚è≥ Salvando...' : '‚úì Salvar'}
                                    </button>
                                    <button onclick="formData = { name: '', breed: '', age: '', gender: 'Macho', color: '', registration: '', photo: '', notes: '' }; toggleForm()" class="px-6 py-3 bg-gray-400 text-white rounded-xl hover:bg-gray-500">‚úï</button>
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    ${state.horses.length === 0 ? `
                        <div class="bg-white rounded-3xl shadow-2xl p-12 text-center">
                            <div class="text-8xl mb-6">üê¥</div>
                            <h2 class="text-3xl font-bold text-gray-800 mb-4">Nenhum cavalo cadastrado</h2>
                            <button onclick="toggleForm()" class="px-8 py-4 bg-blue-600 text-white rounded-xl font-semibold">
                                ‚ûï Adicionar Primeiro Cavalo
                            </button>
                        </div>
                    ` : `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${horsesHTML}
                        </div>
                    `}
                </div>
            `;
        }

        function renderHorseDetail() {
            const horse = state.selectedHorse;
            
            return `
                <div class="max-w-7xl mx-auto p-4">
                    <div class="bg-white rounded-3xl shadow-2xl p-6">
                        <div class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-6 rounded-2xl mb-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h2 class="text-4xl font-black mb-2">${horse.name}</h2>
                                    <p class="text-emerald-100">${horse.breed} ‚Ä¢ ${horse.age} anos</p>
                                </div>
                                ${horse.photo ? `<img src="${horse.photo}" class="w-32 h-32 object-cover rounded-xl border-4 border-white">` : ''}
                            </div>
                            <button onclick="backToList()" class="mt-4 px-6 py-2 bg-white text-emerald-600 rounded-xl font-semibold">
                                ‚Üê Voltar
                            </button>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            ${renderVaccines(horse)}
                            ${renderMedications(horse)}
                            ${renderShoeing(horse)}
                            ${renderExpenses(horse)}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderVaccines(horse) {
            const vaccinesHTML = horse.vaccines?.map(v => `
                <div class="bg-white p-4 rounded-xl border border-purple-200 relative group hover:shadow-md transition">
                    <button onclick="deleteItem('vaccines', ${v.id})" 
                        class="absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition">
                        üóëÔ∏è
                    </button>
                    <p class="font-bold text-purple-900">${v.vaccine}</p>
                    <p class="text-sm text-gray-600">üìÖ ${v.date}</p>
                    ${v.next_date ? `<p class="text-sm text-purple-600 font-semibold">üîî Pr√≥xima: ${v.next_date}</p>` : ''}
                </div>
            `).join('') || '<p class="text-gray-500 text-center py-4">Nenhuma vacina</p>';

            return `
                <div class="bg-purple-50 p-6 rounded-2xl border-2 border-purple-200">
                    <h3 class="text-xl font-bold text-purple-900 mb-4">üíâ Vacinas</h3>
                    <div class="space-y-3 mb-4 max-h-60 overflow-y-auto">${vaccinesHTML}</div>
                    <div class="space-y-3 bg-white p-4 rounded-xl">
                        <input type="date" id="vaccineDate" class="w-full p-3 border-2 rounded-lg">
                        <input type="text" placeholder="Nome da vacina" id="vaccineName" class="w-full p-3 border-2 rounded-lg">
                        <input type="date" id="vaccineNext" class="w-full p-3 border-2 rounded-lg">
                        <button onclick="addVaccine()" class="w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold">
                            ‚ûï Adicionar Vacina
                        </button>
                    </div>
                </div>
            `;
        }

        function renderMedications(horse) {
            const medsHTML = horse.medications?.map(m => `
                <div class="bg-white p-4 rounded-xl border border-pink-200 relative group hover:shadow-md transition">
                    <button onclick="deleteItem('medications', ${m.id})" 
                        class="absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition">
                        üóëÔ∏è
                    </button>
                    <p class="font-bold text-pink-900">${m.medication}</p>
                    <p class="text-sm text-gray-600">üìÖ ${m.date}</p>
                    <p class="text-sm text-gray-600">üíä ${m.dosage}</p>
                    <p class="text-sm text-gray-600">üë®‚Äç‚öïÔ∏è ${m.vet}</p>
                </div>
            `).join('') || '<p class="text-gray-500 text-center py-4">Nenhuma medica√ß√£o</p>';

            return `
                <div class="bg-pink-50 p-6 rounded-2xl border-2 border-pink-200">
                    <h3 class="text-xl font-bold text-pink-900 mb-4">üíä Medica√ß√µes</h3>
                    <div class="space-y-3 mb-4 max-h-60 overflow-y-auto">${medsHTML}</div>
                    <div class="space-y-3 bg-white p-4 rounded-xl">
                        <input type="date" id="medDate" class="w-full p-3 border-2 rounded-lg">
                        <input type="text" placeholder="Medica√ß√£o" id="medName" class="w-full p-3 border-2 rounded-lg">
                        <input type="text" placeholder="Dosagem" id="medDosage" class="w-full p-3 border-2 rounded-lg">
                        <input type="text" placeholder="Veterin√°rio" id="medVet" class="w-full p-3 border-2 rounded-lg">
                        <button onclick="addMedication()" class="w-full px-4 py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700 font-semibold">
                            ‚ûï Adicionar Medica√ß√£o
                        </button>
                    </div>
                </div>
            `;
        }

        function renderShoeing(horse) {
            const shoeingHTML = horse.shoeing?.map(s => `
                <div class="bg-white p-4 rounded-xl border border-orange-200 relative group hover:shadow-md transition">
                    <button onclick="deleteItem('shoeing', ${s.id})" 
                        class="absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition">
                        üóëÔ∏è
                    </button>
                    <p class="font-bold text-orange-900">üî® Ferrageamento</p>
                    <p class="text-sm text-gray-600">üìÖ ${s.date}</p>
                    ${s.next_date ? `<p class="text-sm text-orange-600 font-semibold">üîî Pr√≥ximo: ${s.next_date}</p>` : ''}
                    ${s.farrier ? `<p class="text-sm text-gray-600">üë∑ ${s.farrier}</p>` : ''}
                    ${s.notes ? `<p class="text-sm text-gray-600 italic">${s.notes}</p>` : ''}
                </div>
            `).join('') || '<p class="text-gray-500 text-center py-4">Nenhum ferrageamento</p>';

            return `
                <div class="bg-orange-50 p-6 rounded-2xl border-2 border-orange-200">
                    <h3 class="text-xl font-bold text-orange-900 mb-4">üî® Ferrageamento</h3>
                    <div class="space-y-3 mb-4 max-h-60 overflow-y-auto">${shoeingHTML}</div>
                    <div class="space-y-3 bg-white p-4 rounded-xl">
                        <input type="date" id="shoeDate" class="w-full p-3 border-2 rounded-lg">
                        <input type="date" id="shoeNext" placeholder="Pr√≥xima ferragem" class="w-full p-3 border-2 rounded-lg">
                        <input type="text" placeholder="Ferrador" id="shoeFarrier" class="w-full p-3 border-2 rounded-lg">
                        <input type="text" placeholder="Observa√ß√µes" id="shoeNotes" class="w-full p-3 border-2 rounded-lg">
                        <button onclick="addShoeing()" class="w-full px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-semibold">
                            ‚ûï Adicionar Ferrageamento
                        </button>
                    </div>
                </div>
            `;
        }

        function renderExpenses(horse) {
            const expensesHTML = horse.expenses?.map(e => `
                <div class="bg-white p-4 rounded-xl border border-amber-200 flex justify-between items-center relative group hover:shadow-md transition">
                    <div class="flex-1">
                        <p class="font-bold text-amber-900">${e.description}</p>
                        <p class="text-sm text-gray-600">üìÖ ${e.date}</p>
                        <span class="inline-block mt-1 px-2 py-1 bg-amber-100 text-amber-700 text-xs rounded-full">${e.category}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <p class="text-xl font-bold text-amber-700">R$ ${parseFloat(e.amount).toFixed(2)}</p>
                        <button onclick="deleteItem('expenses', ${e.id})" 
                            class="p-1.5 bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('') || '<p class="text-gray-500 text-center py-4">Nenhum gasto</p>';

            return `
                <div class="bg-amber-50 p-6 rounded-2xl border-2 border-amber-200 lg:col-span-2">
                    <h3 class="text-xl font-bold text-amber-900 mb-4">üí∞ Controle Financeiro</h3>
                    <div class="mb-6 bg-white p-4 rounded-xl border-2 border-amber-300">
                        <p class="text-3xl font-black text-amber-800">R$ ${getTotalExpenses(horse).toFixed(2)}</p>
                        <p class="text-sm text-amber-600">Total investido</p>
                    </div>
                    <div class="space-y-3 mb-4 max-h-80 overflow-y-auto">${expensesHTML}</div>
                    <div class="bg-white p-4 rounded-xl">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                            <input type="date" id="expDate" class="p-3 border-2 rounded-lg">
                            <input type="text" placeholder="Descri√ß√£o" id="expDesc" class="p-3 border-2 rounded-lg">
                            <input type="number" step="0.01" placeholder="Valor (R$)" id="expAmount" class="p-3 border-2 rounded-lg">
                            <select id="expCategory" class="p-3 border-2 rounded-lg">
                                <option>Alimenta√ß√£o</option>
                                <option>Veterin√°rio</option>
                                <option>Manuten√ß√£o</option>
                                <option>Medicamentos</option>
                                <option>Ferrageamento</option>
                                <option>Outros</option>
                            </select>
                        </div>
                        <button onclick="addExpense()" class="w-full px-4 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 font-semibold">
                            ‚ûï Adicionar Gasto
                        </button>
                    </div>
                </div>
            `;
        }

        // Inicializar
        init();
    </script>
</body>
</html>
