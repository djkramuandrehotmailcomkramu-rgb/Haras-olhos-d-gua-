<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Controle Haras Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-green-50 min-h-screen" id="body">
<div id="app"></div>

<script>
const USER = "admin";
const PASS = "1234";

const storage = {
  get: (k) => JSON.parse(localStorage.getItem(k) || "null"),
  set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
};

let logged = false;

let data = storage.get("haras") || [];

let state = { selected: null };

function loginScreen() {
  document.getElementById("app").innerHTML = `
  <div class="max-w-sm mx-auto p-6 mt-20 bg-white rounded-xl shadow">
    <h2 class="text-xl font-bold mb-4">Login</h2>
    <input id="user" class="border p-2 w-full mb-2" placeholder="Usuário">
    <input id="pass" type="password" class="border p-2 w-full mb-4" placeholder="Senha">
    <button onclick="login()" class="bg-green-600 text-white px-4 py-2 w-full rounded">Entrar</button>
  </div>`;
}

function login() {
  const u = user.value;
  const p = pass.value;
  if (u === USER && p === PASS){
    logged = true;
    render();
  } else {
    alert("Usuário ou senha incorretos");
  }
}

function save() {
  storage.set("haras", data);
}

function exportData(){
  const json = JSON.stringify(data, null, 2);
  const blob = new Blob([json], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "backup_haras.json";
  a.click();
}

function render(){
  if(!logged) return loginScreen();

  if(state.selected !== null){
    return renderDetail();
  }

  const list = data.map((h,i)=>`
    <div class="bg-white p-4 rounded shadow">
      <img src="${h.photo || ''}" class="w-full h-48 object-cover rounded mb-2"/>
      <h3 class="font-bold">${h.name}</h3>
      <button onclick="openHorse(${i})" class="bg-blue-600 text-white px-3 py-1 mt-2 rounded">Abrir</button>
    </div>`).join("");

  app.innerHTML = `
  <div class="max-w-6xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">Controle do Haras</h1>
    <button onclick="exportData()" class="bg-purple-600 text-white px-4 py-2 mb-4 rounded">Exportar Dados</button>
    <div class="grid md:grid-cols-3 gap-4">${list}</div>
    <button onclick="addHorse()" class="bg-green-600 text-white px-4 py-2 mt-6 rounded">Novo Cavalo</button>
  </div>`;
}

function addHorse(){
  const name = prompt("Nome do cavalo:");
  if(!name) return;

  const horse = {
    name,
    photo:"",
    trainings:[],
    injuries:[],
    farrier:[]
  };

  data.push(horse);
  save();
  render();
}

function openHorse(i){
  state.selected = i;
  render();
}

function renderDetail(){
  const h = data[state.selected];

  app.innerHTML = `
  <div class="max-w-4xl mx-auto p-4 bg-white shadow rounded">
    <button onclick="back()" class="mb-4 bg-gray-500 text-white px-3 py-1 rounded">Voltar</button>

    <input type="file" accept="image/*" onchange="setPhoto(event)" class="mb-4"/>
    <img src="${h.photo || ''}" class="w-full h-60 object-cover rounded mb-4"/>

    <h2 class="text-2xl font-bold mb-4">${h.name}</h2>

    ${section("Treinos", h.trainings)}
    ${section("Lesões", h.injuries)}
    ${section("Ferragem", h.farrier)}

    <button onclick="addItem('trainings')" class="bg-green-500 text-white px-3 py-1 mt-2 rounded">+ Treino</button>
    <button onclick="addItem('injuries')" class="bg-red-500 text-white px-3 py-1 mt-2 rounded">+ Lesão</button>
    <button onclick="addItem('farrier')" class="bg-yellow-500 text-white px-3 py-1 mt-2 rounded">+ Ferragem</button>
  </div>`;
}

function section(name, arr){
  const html = arr.map(e=>`<div class="border p-2 mb-1 text-sm">${e}</div>`).join("");
  return `<h3 class="font-bold mt-4">${name}</h3>${html}`;
}

function addItem(type){
  const txt = prompt("Descreva:");
  if(!txt) return;
  data[state.selected][type].push(txt);
  save();
  render();
}

function setPhoto(e){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    data[state.selected].photo = reader.result;
    save();
    render();
  };
  reader.readAsDataURL(file);
}

function back(){
  state.selected = null;
  render();
}

render();
</script>
</body>
</html>
